<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Provity</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css"
          rel="stylesheet">
    <!-- Link CSS remains unchanged as requested -->
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f7f7f7;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        /* Navbar styling */
        .navbar-custom {
            background-color: #343a40;
            color: #ffffff;
        }

        .search-input {
            display: none;
            margin-left: 10px;
            max-width: 200px;
        }

        /* Main container */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
            width: 100%;
        }

        /* Category Navigation */
        .category-container {
            flex: 5;
            padding: 20px;
            border-right: 1px solid #ccc;
            overflow-y: auto;
        }

        .category-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .category-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .category-button:hover {
            background-color: #0056b3;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 10px;
        }

        .menu-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .item-image {
            width: 100px;
            height: 100px;
            background-color: #f0f0f0;
            margin: 0 auto;
        }

        /* Order Summary */
        .order-summary {
            flex: 3;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
            border-left: 1px solid #ccc;
        }

        .totals {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
        }

        .history-btn, .pay-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .history-btn {
            background-color: #007bff;
            color: white;
        }

        .pay-btn {
            background-color: #5cb85c;
            color: white;
        }

        /* Form Styling */
        .form-san-pham, .form-khach-hang {
            border: 1px solid #ddd;
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }

        .form-row {
            display: flex;
            justify-content: space-between;
        }

        .form-khach-hang small {
            display: block;
            margin-bottom: 8px;
        }

        .input-field.small-text {
            font-size: 0.9em;
            padding: 6px;
            width: 100%;
        }

        /* Bordered Product for Form */
        .bordered-product {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 10px;
        }

        /* Button group */
        .button-group {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .add-customer-btn, .new-bill-btn, .reload-btn {
            padding: 8px 12px;
            border: none;
            background-color: #f1f1f1;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            margin: 0 5px;
        }

        .right-buttons {
            display: flex;
            gap: 5px;
        }

        .add-customer-btn i, .new-bill-btn i, .reload-btn i {
            margin-right: 5px;
        }

        .add-customer-btn:hover, .new-bill-btn:hover, .reload-btn:hover {
            background-color: #ffc107;
            color: white;
        }

        /* Centered Customer Form */
        .customer-form {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Close button for customer form */
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        table {
            width: 100%; /* Chiếm toàn bộ chiều rộng */
            border-collapse: collapse; /* Gộp các đường viền */
        }

        input[type="text"], input[type="number"] {
            width: 100%; /* Chiếm toàn bộ chiều rộng của ô */
            border: none; /* Ẩn đường viền của input */
            padding: 4px; /* Khoảng cách bên trong input */
            box-sizing: border-box; /* Đảm bảo padding không làm tăng chiều rộng */
        }

        input[type="text"][readonly] {
            background-color: #f2f2f2; /* Màu nền cho input chỉ đọc */
        }

        th, td {
            border: 1px solid #ddd; /* Đường viền nhẹ */
            padding: 8px; /* Khoảng cách bên trong ô */
            text-align: left; /* Căn trái nội dung */
        }

        th {
            background-color: #f2f2f2; /* Màu nền cho tiêu đề */
        }

        tr:hover {
            background-color: #f5f5f5; /* Hiệu ứng hover cho hàng */
        }
    </style>
    <script>

    </script>
</head>

<body>
<!-- Header Section -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="/user/ban-hang">Bán Hàng</a>
            <a class="nav-item nav-link" href="">Quản Lý</a>
            <a class="nav-item nav-link">Khách Hàng</a>
            <a class="nav-item nav-link" href="/user/don-hang">Đơn hàng</a>
        </div>

        <div class="ml-auto d-flex align-items-center">
            <input type="text" id="searchInput" class="form-control search-input" placeholder="Tìm kiếm...">
            <button class="btn btn-outline-light" type="button" onclick="handleSearch()">
                <i class="bi bi-search"></i>
            </button>
            <a class="btn btn-outline-light" href="/src/main/webapp/views/admin/accNV/nvAcc.html">
                <i class="bi bi-person-circle"></i>
            </a>
        </div>
    </div>
</nav>

<!-- Main Container -->
<div class="main-container">
    <!-- Category Navigation -->
    <div class="category-container">
        <div class="category-buttons">
            <form id="searchForm"
                  th:action="@{${donHang.id} != null ? '/user/ban-hang/' + ${donHang.id} : '/user/ban-hang'}"
                  method="get">

                <!-- Chọn sản phẩm -->
                <select name="idSanPham" id="idSanPham">
                    <option value="">Chọn sản phẩm</option>
                    <option th:each="sanPham : ${sanPhams}"
                            th:value="${sanPham.id}"
                            th:text="${sanPham.ten}"></option>
                </select>

                <!-- Chọn màu sắc -->
                <select name="mauSac" id="mauSac">
                    <option value="">Chọn màu sắc</option>
                    <option th:each="mau : ${mauSacs}"
                            th:value="${mau.id}"
                            th:text="${mau.ten}"></option>
                </select>

                <!-- Chọn hãng -->
                <select name="hang" id="hang">
                    <option value="">Chọn hãng</option>
                    <option th:each="hang : ${hangs}"
                            th:value="${hang.id}"
                            th:text="${hang.ten}"></option>
                </select>

                <!-- Chọn loại sản phẩm -->
                <select name="idLoaiSP" id="idLoaiSP">
                    <option value="">Chọn loại sản phẩm</option>
                    <option th:each="loaiSP : ${loaiSanPhams}"
                            th:value="${loaiSP.id}"
                            th:text="${loaiSP.kieuDang}"></option>
                </select>

                <!-- Chọn khoảng đơn giá -->
                <select name="donGia" id="donGia">
                    <option value="">Chọn khoảng giá</option>
                    <option value="0-5000000">0 - 5,000,000</option>
                    <option value="5000001-10000000">5,000,001 - 10,000,000</option>
                    <option value="10000001-15000000">10,000,001 - 15,000,000</option>
                    <option value="15000001-20000000">15,000,001 - 20,000,000</option>
                    <option value="20000001+">Trên 20,000,000</option>
                </select>

                <button type="submit" class="btn btn-outline-dark">Tìm Kiếm</button>
            </form>
        </div>

        <div class="menu-items">
            <table id="dataTable" class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Sản phẩm</th>
                    <th>Màu sắc</th>
                    <th>Hãng</th>
                    <th>Hình ảnh</th>
                    <th>Loại sản phẩm</th>
                    <th>Đơn giá</th>
                    <th>Số lượng</th>
                    <th>Trạng thái</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody id="tableBody">
                <tr th:each="spct : ${spct}">
                    <td th:text="${spct.id}"></td>
                    <td th:text="${spct.sanPham.ten}"></td>
                    <td th:text="${spct.mauSac.ten}"></td>
                    <td th:text="${spct.hang.ten}"></td>
                    <td>
                        <img th:src="@{/images/tainghe/{ten}(ten=${spct.hinhAnh.ten})}"
                             style="width: 100px; height: auto;"/>
                    </td>
                    <td th:text="${spct.loaiSanPham.kieuDang}"></td>
                    <td th:text="${spct.donGia}"></td>
                    <td th:text="${spct.soLuong}"></td>
                    <td th:text="${spct.trangThai}"></td>
                    <td>
                        <button th:attr="onclick='addProductToForm(${spct.id}, ${spct.donGia}, ${spct.soLuong}, ${spct.sanPham.ten})'">
                            Add Product
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
        <!-- Button group for Add Khách Hàng, New Bill, and Reload -->
        <div class="button-group">
            <button class="add-customer-btn" onclick="openCustomerForm()"><i class="bi bi-person-plus"></i> Add Khách
                Hàng
            </button>
            <div class="right-buttons">
                <button class="new-bill-btn" onclick="showForms()"><i class="bi bi-plus-circle"></i></button>
                <button class="reload-btn"><i class="bi bi-arrow-repeat"></i></button>
            </div>
        </div>

        <div class="form-san-pham" style="display: none;">
            <div>
                <h3>Tạo đơn hàng</h3>
                <form id="orderFormDetails" th:object="${donHang}" method="post" th:action="@{/user/ban-hang/save}">
                    <!--                method="POST"-->
                    <!--                th:object="${donHang}"-->
                    <!--                th:action="@{/don-hang/save}"-->
                    <label>Đơn Hàng</label>
                    <input type="text" th:field="*{id}" disabled>
                    <!--                <label>Khách Hàng: </label>-->
                    <!--                <select th:field="*{khachHang.id}">-->
                    <!--                    <option th:each="khachHang : ${listKh}"-->
                    <!--                            th:value="${khachHang.id}"-->
                    <!--                            th:text="${khachHang.ten}"></option>-->
                    <!--                </select>-->
                    <label>Khách Hàng: </label>
                    <input type="text" id="khachHangInput" placeholder="Khách hàng" readonly
                           th:field="*{khachHang.ten}"/>
                    <input type="hidden" id="khachHangId" name="idKhachHang" th:field="*{khachHang.id}"/>
                    <br>
                    <label>Tổng Giá:</label>
                    <input type="text" th:field="*{tongGia}" value="${donHang.tongGia ?: 0}" disabled>
                    <br>
                    <label>Trạng Thái:</label>
                    <input type="text" placeholder="Nhập trạng thái" th:field="*{trangThai}"/>
                    <br>

                    <label>Ngày Giao:</label>
                    <input type="date" th:field="*{ngayGiao}"/>

                    <button type="submit">Lưu đơn hàng</button>
                </form>
                <button onclick="viewOrderDetails()">Xem chi tiết</button>
            </div>

            <!-- Nút để xem chi tiết đơn hàng theo ID đơn hàng -->


            <!-- Forms to be displayed after "+" button click -->
            <div id="orderDetailsForm" class="form-don-hang" style="display: none;">
                <h3>Chi tiết đơn hàng</h3>
                <form th:object="${donHangChiTiet}" th:action="@{/user/ban-hang/{id}(id=${donHang.id})}"
                      method="post">
                    <!--                                        onsubmit="saveOrderDetails()"-->
                    <!--                    <input type="hidden" th:field="*{donHang}">-->
                    <!--                    <label>ID Sản Phẩm:</label>-->
                    <!--                    <input type="text" th:field="*{sanPhamChiTiet.id}"/>-->

                    <!--                    <label>Số Lượng:</label>-->
                    <!--                    <input type="number" th:field="*{soLuong}"/>-->

                    <!--                    <label>Đơn Giá:</label>-->
                    <!--                    <input type="number" th:field="*{donGia}"/>-->


                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Tên sản phẩm</th>
                            <th>Số lượng</th>
                            <th>Đơn giá</th>

                        </tr>
                        </thead>
                        <tbody id="addedProductsTableBody">
                        <!--                        selectedProductsBody-->
                        <!-- Các sản phẩm sẽ được thêm vào đây -->
                        <tr>
                            <!--                            <td><input type="text" th:field="*{sanPhamChiTiet.id}"/></td>-->
                            <!--                            <td><input type="number" th:field="*{soLuong}"/></td>-->
                            <!--                            <td><input type="number" th:field="*{donGia}"/></td>-->

                        </tr>
                        </tbody>
                    </table>
                    <button type="submit">Xác nhận tất cả sản phẩm</button>
                </form>
            </div>
            <div class="totals">
                <div class="total-item">
                    <label>Tổng:</label>
                    <span id="totalAmount">0</span>
                </div>
                <div class="total-item">
                    <label>Nhập số tiền khách đưa:</label>
                    <input type="text" id="customerPayment" oninput="calculateChange()" placeholder="Nhập số tiền"/>
                </div>
                <div class="total-item">
                    <label>Số tiền trả lại:</label>
                    <span id="changeAmount">0</span>
                </div>
            </div>
            <!-- Customer Form -->
            <div class="customer-form" id="customerForm" style="display: none;">
                <div class="form-container">
                    <button class="close-btn" onclick="closeCustomerForm()">✖</button> <!-- Close button -->
                    <label>Nhập tên:</label>
                    <input type="text" placeholder="Nhập tên" class="form-control" id="customerName">
                    <label>Nhập SĐT:</label>
                    <input type="text" placeholder="Nhập SĐT" class="form-control" id="customerPhone">
                    <button class="btn btn-primary" onclick="searchCustomer()">
                        <i class="bi bi-search"></i> Tìm kiếm
                    </button>
                    <table class="table mt-3">
                        <thead>
                        <tr>
                            <th>Tên KH</th>
                            <th>SĐT</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="customer-list">
                        <tr th:each="kh : ${listKh}"
                            onclick="selectCustomer([[${kh.id}]], '[[${kh.ten}]]', '[[${kh.sdt}]]')">
                            <td th:text="${kh.ten}"></td>
                            <td th:text="${kh.sdt}"></td>
                            <td>Chọn</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="history-btn" onclick="toggleHistoryForm()">Lịch Sử</button>
                <button class="pay-btn" onclick="processPayment()">Thanh Toán</button> <!-- Thêm onclick ở đây -->
            </div>

            <!-- History Form remains unchanged -->
            <div class="history-form" style="display: none;">
                <div class="form-container">
                    <label for="history-code">Mã Lịch Sử:</label>
                    <input type="text" id="history-code" placeholder="Nhập mã lịch sử">
                    <button class="search-btn"><i class="bi bi-search"></i></button>
                </div>
                <div class="list-data">
                    <ul>
                        <li>Mã Danh Sách 1</li>
                        <li>Mã Danh Sách 2</li>
                        <li>Mã Danh Sách 3</li>
                        <li>Mã Danh Sách 4</li>
                        <li>Mã Danh Sách 5</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
    let formDisplayed = false;
    let selectedProducts = []; // Mảng lưu trữ sản phẩm đã chọn

    document.addEventListener('DOMContentLoaded', function () {
        // Thêm sự kiện cho các nút "Add Product"
        addProductButtonEventListeners();
    });

    // Hàm thêm sự kiện cho nút "Add Product"
    function addProductButtonEventListeners() {
        const addProductButtons = document.querySelectorAll('td button');
        addProductButtons.forEach(button => {
            button.addEventListener('click', function () {
                const row = this.closest('tr');
                const spctId = row.querySelector('td:nth-child(1)').textContent.trim();
                const productName = row.querySelector('td:nth-child(2)').textContent.trim();
                const quantity = 1;
                // const quantity = parseInt(row.querySelector('td:nth-child(8)').textContent.trim(), 10) || 0;
                const price = parseFloat(row.querySelector('td:nth-child(7)').textContent.trim()) || 0;

                addProductToForm(spctId, productName, quantity, price);
            });
        });
    }

    // Hàm xử lý việc tìm kiếm
    $(document).ready(function () {
        $('#searchForm').submit(function (event) {
            event.preventDefault(); // Ngừng reload trang

            var formAction = $(this).attr('action'); // Lấy URL từ form action
            var formData = $(this).serialize(); // Lấy dữ liệu form

            $.ajax({
                url: formAction,
                method: 'GET',
                data: formData,
                success: function (response) {
                    // Cập nhật bảng với dữ liệu mới
                    $('#tableBody').html($(response).find('#tableBody').html());

                    // Gắn lại sự kiện cho các nút "Add Product"
                    addProductButtonEventListeners();
                },
                error: function () {
                    alert('Có lỗi xảy ra trong quá trình tìm kiếm!');
                }
            });
        });
    });

    function addProductToForm(spctId, productName, quantity, price) {
        const addedProductsTableBody = document.getElementById('addedProductsTableBody');

        if (!addedProductsTableBody) {
            console.error('Phần tử tbody không tồn tại!');
            return;
        }

        // Kiểm tra xem sản phẩm đã tồn tại trong giỏ chưa
        let existingProduct = selectedProducts.find(product => product.spctId === spctId);

        if (existingProduct) {
            // Nếu sản phẩm đã có trong giỏ, tăng số lượng lên
            existingProduct.quantity += quantity;

            // Cập nhật lại số lượng trong bảng giỏ hàng
            updateProductQuantityInTable(existingProduct);
        } else {
            // Nếu chưa có trong giỏ, thêm mới
            const newProduct = { spctId, productName, quantity, price };
            selectedProducts.push(newProduct);

            const newRow = document.createElement('tr');
            newRow.innerHTML = `
            <td>
                <span>${productName || 'Chưa có tên sản phẩm'}</span>
                <input type="hidden" name="spctIds" value="${spctId}"/>
            </td>
            <td><input type="number" name="soLuong" value="${quantity}" min="1" /></td>
            <td><input type="number" name="donGia" value="${price}" readonly /></td>
        `;

            addedProductsTableBody.appendChild(newRow);
        }
    }

    function updateProductQuantityInTable(product) {
        const rows = document.querySelectorAll('#addedProductsTableBody tr');
        rows.forEach(row => {
            const spctId = row.querySelector('input[name="spctIds"]').value;
            if (spctId === product.spctId) {
                const quantityInput = row.querySelector('input[name="soLuong"]');
                quantityInput.value = product.quantity; // Cập nhật số lượng
            }
        });
    }

    function saveOrderDetails() {
        // Tạo đối tượng orderRequest
        event.preventDefault();
        const orderRequest = {
            products: selectedProducts,
            // Bạn có thể thêm các thông tin khác như ID đơn hàng, thông tin người dùng, v.v.
        };

        // Gửi orderRequest đến backend
        fetch('/user/ban-hang/save-details', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json' // Thêm header này
            },
            body: JSON.stringify(orderRequest)

        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Order saved successfully:', data);
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    }

    function removeProduct(button) {
        // Xóa hàng sản phẩm khỏi bảng
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    function selectCustomer(id, ten, sdt) {
        // Cập nhật thông tin khách hàng vào form đơn hàng
        document.getElementById('khachHangId').value = id; // Lưu id khách hàng
        document.getElementById('khachHangInput').value = ten; // Hiển thị tên khách hàng
        closeCustomerForm(); // Đóng form khách hàng
    }

    function selectProduct(id) {

    }

    function handleSearch() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput.style.display === 'none' || searchInput.style.display === '') {
            searchInput.style.display = 'block';
            searchInput.focus();
        } else {
            const searchValue = searchInput.value.trim();
            if (searchValue) {
                window.location.href = `sang_pham.html?search=${encodeURIComponent(searchValue)}`;
            }
            searchInput.value = '';
            searchInput.style.display = 'none';
        }
    }


    // Hàm xử lý thanh toán
    // function processPayment() {
    //     const total = parseFloat(document.getElementById('totalAmount').textContent);
    //     const payment = parseFloat(document.getElementById('customerPayment').value);
    //
    //     if (payment >= total) {
    //         // Simulate backend API call
    //         fetch('/user/ban-hang', {
    //             method: 'POST',
    //
    //             headers: {
    //
    //                 'Content-Type': 'application/json',
    //             },
    //             body: JSON.stringify({
    //                 products: selectedProducts,
    //                 totalAmount: total,
    //                 payment: payment
    //             }),
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 alert('Thanh toán thành công!');
    //
    //                 // Reset the cart and UI
    //                 selectedProducts = [];
    //                 document.getElementById('customerPayment').value = '';
    //                 document.getElementById('changeAmount').textContent = '0';
    //                 updateTotalAmount();
    //
    //                 console.log('Success:', data);
    //             })
    //             .catch((error) => {
    //                 console.error('Error:', error);
    //             });
    //
    //     } else {
    //         alert('Số tiền khách đưa không đủ!');
    //     }
    // }

    function showMenu(category) {
        const sections = document.querySelectorAll('.menu-section');
        sections.forEach(section => section.style.display = 'none');
        document.getElementById(category).style.display = 'block';
    }

    function toggleHistoryForm() {
        const historyForm = document.querySelector('.history-form');
        historyForm.style.display = historyForm.style.display === 'block' ? 'none' : 'block';
    }

    function toggleCustomerForm() {
        document.querySelector('.customer-form').style.display = 'block';
    }

    function closeCustomerForm() {
        document.querySelector('.customer-form').style.display = 'none';
    }

    function showForms() {
        const sanPhamForm = document.querySelector('.form-san-pham');
        if (!formDisplayed) {
            sanPhamForm.style.display = 'block';
            formDisplayed = true;
        } else {
            alert('Không thể tạo 2 Bill cùng 1 Thanh Toán');
        }
    }

    function viewOrderDetails() {
        var detailForm = document.getElementById("orderDetailsForm");
        if (detailForm.style.display === "none") {
            detailForm.style.display = "block"; // Hiển thị form
        } else {
            detailForm.style.display = "none"; // Ẩn form nếu đang hiển thị
        }
    }


    // Hiển thị form khách hàng
    function openCustomerForm() {
        document.getElementById("customerForm").style.display = "block";
    }

    // Ẩn form khách hàng
    function closeCustomerForm() {
        document.getElementById("customerForm").style.display = "none";
    }

    // Giả sử có một chức năng tìm kiếm khách hàng (tạm thời là demo)
    function searchCustomer() {
        const name = document.getElementById('customerName').value.trim();
        const phone = document.getElementById('customerPhone').value.trim();

        // Kiểm tra xem ít nhất một trong hai ô nhập có giá trị
        if (!name && !phone) {
            alert("Vui lòng nhập tên hoặc số điện thoại để tìm kiếm.");
            return; // Không thực hiện tìm kiếm nếu cả hai ô đều trống
        }

        // Gửi yêu cầu AJAX đến server để tìm kiếm khách hàng
        fetch(`/api/khach-hang/search?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`)
            .then(response => response.json())
            .then(data => {
                const customerList = document.getElementById('customer-list');
                customerList.innerHTML = ''; // Xóa danh sách cũ

                // Kiểm tra nếu không có khách hàng nào được tìm thấy
                if (data.length === 0) {
                    customerList.innerHTML = '<tr><td colspan="3">Không tìm thấy khách hàng nào.</td></tr>';
                    return;
                }

                // Thêm từng khách hàng vào bảng
                data.forEach(kh => {
                    const row = document.createElement('tr');
                    row.setAttribute('onclick', `selectCustomer('${kh.id}', '${kh.ten}', '${kh.sdt}')`);
                    row.innerHTML = `
                    <td>${kh.ten}</td>
                    <td>${kh.sdt}</td>
                    <td>Chọn</td>
                `;
                    customerList.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Có lỗi xảy ra khi tìm kiếm khách hàng:', error);
            });
    }

    window.onload = function () {
        // Lấy id từ URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('id'); // Lấy id từ query string

        // Gán id vào các input
        if (orderId) {
            document.querySelector('input[name="donHang.id"]').value = orderId;
        }
    }; // Gán vào input tương ứng

    function addProductToForm(spctId, productName, quantity, price) {
        const addedProductsTableBody = document.getElementById('addedProductsTableBody');

        if (!addedProductsTableBody) {
            console.error('Phần tử tbody không tồn tại!');
            return;
        }

        const newRow = document.createElement('tr');
        newRow.innerHTML = `
        <td>
            <span>${productName || 'Chưa có tên sản phẩm'}</span>
            <input type="hidden" name="spctIds" value="${spctId}"/>
        </td>
        <td><input type="number" name="soLuong" value="${quantity}" min="1" onchange="updateProductQuantity(this)" /></td>
        <td><input type="number" name="donGia" value="${price}" readonly /></td>
    `;

        addedProductsTableBody.appendChild(newRow);

        // Thêm sản phẩm vào mảng selectedProducts
        selectedProducts.push({ spctId, productName, quantity, price });

        updateTotalAmount(); // Cập nhật tổng tiền
    }

    function updateTotalAmount() {
        const total = selectedProducts.reduce((sum, product) => sum + (product.quantity * product.price), 0);
        document.getElementById('totalAmount').textContent = total.toFixed(2); // Hiển thị tổng với 2 chữ số thập phân
        calculateChange(); // Cập nhật tiền trả lại
    }

    function updateProductQuantity(inputElement) {
        const row = inputElement.closest('tr');
        const quantity = parseInt(inputElement.value, 10) || 0;
        const price = parseFloat(row.querySelector('input[name="donGia"]').value) || 0;
        const spctId = row.querySelector('input[name="spctIds"]').value;

        // Cập nhật số lượng trong mảng selectedProducts
        const productIndex = selectedProducts.findIndex(product => product.spctId === spctId);
        if (productIndex !== -1) {
            selectedProducts[productIndex].quantity = quantity;
        }

        updateTotalAmount(); // Cập nhật tổng tiền
    }

    // Hàm tính toán số tiền trả lại
    function calculateChange() {
        const payment = parseFloat(document.getElementById('customerPayment').value) || 0; // Lấy giá trị tiền khách đưa
        const total = parseFloat(document.getElementById('totalAmount').textContent); // Lấy tổng tiền
        const change = payment - total; // Tính số tiền trả lại

        // Cập nhật số tiền trả lại
        document.getElementById('changeAmount').textContent = change >= 0 ? change.toFixed(2) : '0';
    }
</script>
</body>

</html>
